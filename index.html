<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>N≈ëi Foci EB 2025 Tippj√°t√©k - Admin + J√°t√©kos</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    textarea { resize: vertical; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen p-6">
  <div class="max-w-5xl mx-auto space-y-8">

    <h1 class="text-4xl font-bold mb-6 text-center">N≈ëi Foci EB 2025 Tippj√°t√©k</h1>
    <!-- üîê Admin bel√©p√©s -->
    <div id="adminLogin" class="mb-6">
      <label for="adminPassword" class="block mb-2 font-semibold">Admin jelsz√≥:</label>
      <input id="adminPassword" type="password" placeholder="√çrd be a jelsz√≥t" class="border p-2 rounded w-64">
      <button onclick="checkAdminPassword()" class="bg-blue-600 text-white px-4 py-2 rounded ml-2">Bel√©p√©s</button>
      <p id="adminError" class="text-red-600 mt-2 hidden">Hib√°s jelsz√≥!</p>
    </div>

    <div id="adminPanel" class="hidden mb-6">
      <h2 class="text-2xl font-semibold mb-2">üîß Admin szekci√≥</h2>
      <p class="mb-4 text-gray-700">Itt lehet majd meccseket szerkeszteni (pl. √∫j meccs hozz√°ad√°s).</p>
      <!-- K√©s≈ëbbi admin funkci√≥k ide j√∂nnek -->
    </div>


    <!-- Admin szekci√≥ -->
    <section id="adminSection" class="bg-white p-6 rounded shadow">
      <h2 class="text-2xl font-semibold mb-4">Admin fel√ºlet - Meccsek kezel√©se</h2>

      <form id="matchForm" class="space-y-4">
        <div class="grid grid-cols-12 gap-4 items-center">
          <input type="text" id="team1Input" placeholder="Csapat 1" required class="col-span-3 border rounded p-2" />
          <input type="text" id="team2Input" placeholder="Csapat 2" required class="col-span-3 border rounded p-2" />
          <input type="datetime-local" id="dateInput" required class="col-span-3 border rounded p-2" />
          <input type="text" id="resultInput" placeholder="Eredm√©ny pl. 2-1 vagy √ºres" class="col-span-2 border rounded p-2" />
          <select id="statusInput" class="col-span-1 border rounded p-2" required>
            <option value="active">Akt√≠v (tippelhet≈ë)</option>
            <option value="closed">Lez√°rt (lez√°rva)</option>
          </select>
        </div>
        <button type="submit" class="bg-green-600 text-white rounded py-2 px-4 hover:bg-green-700">√öj meccs hozz√°ad√°sa</button>
      </form>

      <h3 class="mt-6 text-xl font-semibold">Meccsek list√°ja</h3>
      <div id="matchesList" class="mt-2 max-h-64 overflow-auto border rounded p-2 bg-gray-50"></div>
    </section>

    <!-- J√°t√©kos szekci√≥ -->
    <section id="playerSection" class="bg-white p-6 rounded shadow">
      <h2 class="text-2xl font-semibold mb-4">J√°t√©kos fel√ºlet</h2>

      <div id="loginDiv" class="mb-6">
        <label for="playerName" class="block font-semibold mb-2">J√°t√©kos n√©v:</label>
        <input type="text" id="playerName" class="border rounded p-2 w-full max-w-xs" placeholder="√çrd be a neved..." />
        <button id="loginBtn" class="mt-2 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">Bel√©p√©s</button>
        <p id="loginError" class="text-red-600 mt-2 hidden">K√©rlek, adj meg egy nevet!</p>
      </div>

      <div id="gameDiv" class="hidden">
        <p class="mb-4">√údv, <span id="currentPlayerName" class="font-semibold"></span>! Tippeld meg az akt√≠v meccseket:</p>
        <form id="tipForm" class="space-y-4"></form>
        <button id="submitTipsBtn" class="bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 mt-4">Tipp ment√©se</button>
        <div id="tipResult" class="mt-6"></div>
      </div>
    </section>

    <!-- Ranglista -->
    <section id="leaderboardSection" class="bg-white p-6 rounded shadow">
      <h2 class="text-2xl font-semibold mb-4">Ranglista</h2>
      <ul id="leaderboard" class="list-disc pl-5"></ul>
    </section>

  </div>

<script>
  // --- El≈ëre felt√∂lt√∂tt meccsek ---
  const defaultMatches = [
    { id: "m1", team1: "Sv√°jc", team2: "Norv√©gia", date: "2025-07-02T21:00", result: null, status: "active" },
    { id: "m2", team1: "Spanyolorsz√°g", team2: "Portug√°lia", date: "2025-07-03T21:00", result: null, status: "active" },
    { id: "m3", team1: "N√©metorsz√°g", team2: "Sv√©dorsz√°g", date: "2025-07-04T21:00", result: null, status: "active" },
    { id: "m4", team1: "Anglia", team2: "Franciaorsz√°g", date: "2025-07-05T21:00", result: null, status: "active" },
  ];

  // --- LocalStorage kulcsok ---
  const LS_MATCHES_KEY = "noifoci_matches";
  const LS_TIPS_KEY = "noifoci_tips"; // { playerName: { matchId: [tipp1, tipp2] } }

  // --- DOM elemek ---
  const matchForm = document.getElementById("matchForm");
  const team1Input = document.getElementById("team1Input");
  const team2Input = document.getElementById("team2Input");
  const dateInput = document.getElementById("dateInput");
  const resultInput = document.getElementById("resultInput");
  const statusInput = document.getElementById("statusInput");
  const matchesList = document.getElementById("matchesList");

  const loginDiv = document.getElementById("loginDiv");
  const playerNameInput = document.getElementById("playerName");
  const loginBtn = document.getElementById("loginBtn");
  const loginError = document.getElementById("loginError");
  const gameDiv = document.getElementById("gameDiv");
  const currentPlayerNameSpan = document.getElementById("currentPlayerName");
  const tipForm = document.getElementById("tipForm");
  const submitTipsBtn = document.getElementById("submitTipsBtn");
  const tipResult = document.getElementById("tipResult");
  const leaderboard = document.getElementById("leaderboard");

  // --- Seg√©df√ºggv√©nyek ---
  function generateId() {
    return '_' + Math.random().toString(36).substr(2, 9);
  }

  // --- Meccsek bet√∂lt√©se, el≈ëre felt√∂lt√©s ha √ºres ---
  function loadMatches() {
    const raw = localStorage.getItem(LS_MATCHES_KEY);
    if (!raw) {
      // localStorage √ºres, bet√∂ltj√ºk az alap√©rtelmezett meccseket
      saveMatches(defaultMatches);
      return defaultMatches;
    }
    try {
      return JSON.parse(raw);
    } catch {
      return [];
    }
  }

  // Meccsek ment√©se
  function saveMatches(matches) {
    localStorage.setItem(LS_MATCHES_KEY, JSON.stringify(matches));
  }

  // Meccs hozz√°ad√°sa
  function addMatch(team1, team2, dateISO, resultStr, status) {
    const matches = loadMatches();
    let result = null;
    if (resultStr.trim() !== "") {
      const m = resultStr.trim().match(/^(\d+)\s*-\s*(\d+)$/);
      if (m) {
        result = [parseInt(m[1]), parseInt(m[2])];
      }
    }
    matches.push({
      id: generateId(),
      team1,
      team2,
      date: dateISO,
      result,
      status
    });
    saveMatches(matches);
  }

  // Meccsek list√°z√°sa admin fel√ºleten
  function renderMatchesList() {
    const matches = loadMatches();
    if (matches.length === 0) {
      matchesList.innerHTML = "<p>Nincsenek meccsek.</p>";
      return;
    }

    matchesList.innerHTML = "";
    matches.forEach((m) => {
      const div = document.createElement("div");
      div.className = "flex items-center justify-between p-2 border-b";

      const dateStr = new Date(m.date).toLocaleString();

      const resStr = m.result ? `${m.result[0]} - ${m.result[1]}` : "Nincs eredm√©ny";

      div.innerHTML = `
        <div class="flex space-x-4 items-center flex-wrap max-w-3xl">
          <span class="font-semibold">${m.team1}</span>
          <span>vs</span>
          <span class="font-semibold">${m.team2}</span>
          <span>‚Ä¢ ${dateStr}</span>
          <span class="ml-2">‚Ä¢ Eredm√©ny: ${resStr}</span>
          <span class="ml-2 font-medium capitalize">‚Ä¢ St√°tusz: ${m.status}</span>
        </div>
        <button class="text-red-600 hover:text-red-800 font-bold" data-id="${m.id}">T√∂rl√©s</button>
      `;

      matchesList.appendChild(div);

      // T√∂rl√©s gomb esem√©ny
      div.querySelector("button").addEventListener("click", () => {
        if (confirm(`Biztos t√∂rl√∂d a meccset: ${m.team1} vs ${m.team2}?`)) {
          deleteMatch(m.id);
        }
      });
    });
  }

  // Meccs t√∂rl√©se
  function deleteMatch(id) {
    let matches = loadMatches();
    matches = matches.filter(m => m.id !== id);
    saveMatches(matches);
    renderMatchesList();
    renderPlayerForm(); // friss√≠tj√ºk a j√°t√©kos fel√ºletet is
  }

  // --- Tippel√©s kezel√©se ---

  // Tipp adat bet√∂lt√©se localStorage-b√≥l
  // { playerName: { matchId: [tipp1, tipp2] } }
  function loadTips() {
    const raw = localStorage.getItem(LS_TIPS_KEY);
    if (!raw) return {};
    try {
      return JSON.parse(raw);
    } catch {
      return {};
    }
  }

  // Tipp ment√©se localStorage-ba
  function saveTips(tips) {
    localStorage.setItem(LS_TIPS_KEY, JSON.stringify(tips));
  }

  // Egy j√°t√©kos tippjeinek lek√©r√©se
  function getPlayerTips(player) {
    const tips = loadTips();
    return tips[player] || {};
  }

  // Egy j√°t√©kos tippjeinek ment√©se
  function savePlayerTips(player, playerTips) {
    const tips = loadTips();
    tips[player] = playerTips;
    saveTips(tips);
  }

  // --- Pontsz√°m√≠t√°s ---
  function getPoints(pred1, pred2, act1, act2) {
    if (pred1 === act1 && pred2 === act2) return 3;
    if (
      (pred1 > pred2 && act1 > act2) ||
      (pred1 < pred2 && act1 < act2) ||
      (pred1 === pred2 && act1 === act2)
    ) return 1;
    return 0;
  }

  // --- Admin form bek√ºld√©se ---
  matchForm.addEventListener("submit", e => {
    e.preventDefault();
    const team1 = team1Input.value.trim();
    const team2 = team2Input.value.trim();
    const dateISO = dateInput.value;
    const resultStr = resultInput.value.trim();
    const status = statusInput.value;

    if (!team1 || !team2 || !dateISO) {
      alert("K√©rlek, t√∂lts ki minden mez≈ët (eredm√©ny lehet √ºres).");
      return;
    }

    addMatch(team1, team2, dateISO, resultStr, status);
    matchForm.reset();
    renderMatchesList();
    renderPlayerForm();
  });

  // --- J√°t√©kos bejelentkez√©s ---
  let currentPlayer = null;

  loginBtn.addEventListener("click", () => {
    const name = playerNameInput.value.trim();
    if (!name) {
      loginError.classList.remove("hidden");
      return;
    }
    loginError.classList.add("hidden");
    currentPlayer = name;
    loginDiv.classList.add("hidden");
    gameDiv.classList.remove("hidden");
    currentPlayerNameSpan.textContent = currentPlayer;
    renderPlayerForm();
    loadPlayerTipsAndShow();
    renderLeaderboard();
  });

  // --- J√°t√©kos tippel√©si ≈±rlap dinamikus megjelen√≠t√©se ---
  function renderPlayerForm() {
    const matches = loadMatches();
    tipForm.innerHTML = "";

    // Csak az akt√≠v meccsek jelennek meg tippel√©sre
    const activeMatches = matches.filter(m => m.status === "active");

    if (activeMatches.length === 0) {
      tipForm.innerHTML = "<p class='italic text-gray-600'>Nincs akt√≠v meccs tippel√©sre.</p>";
      submitTipsBtn.disabled = true;
      return;
    }

    submitTipsBtn.disabled = false;

    activeMatches.forEach((m, i) => {
      const div = document.createElement("div");
      div.className = "bg-gray-50 rounded p-4 mb-4 shadow";

      div.innerHTML = `
        <div class="flex justify-between mb-2">
          <span class="font-semibold">${m.team1} vs ${m.team2}</span>
          <span class="text-sm text-gray-500">${new Date(m.date).toLocaleString()}</span>
        </div>
        <div class="flex space-x-2">
          <input type="number" min="0" placeholder="${m.team1}" class="border rounded p-2 w-20" name="tip_${m.id}_team1" />
          <span class="self-center">-</span>
          <input type="number" min="0" placeholder="${m.team2}" class="border rounded p-2 w-20" name="tip_${m.id}_team2" />
        </div>
      `;
      tipForm.appendChild(div);
    });

    fillPlayerTipsInputs();
  }

  // Kit√∂lti a j√°t√©kos tippjeit az inputokba
  function fillPlayerTipsInputs() {
    if (!currentPlayer) return;
    const playerTips = getPlayerTips(currentPlayer);
    for (const matchId in playerTips) {
      const inputs = [
        tipForm.querySelector(`[name="tip_${matchId}_team1"]`),
        tipForm.querySelector(`[name="tip_${matchId}_team2"]`)
      ];
      if (inputs[0]) inputs[0].value = playerTips[matchId][0] ?? "";
      if (inputs[1]) inputs[1].value = playerTips[matchId][1] ?? "";
    }
  }

  // Bet√∂lti a j√°t√©kos tippjeit √©s megjelen√≠ti az eredm√©nyt
  function loadPlayerTipsAndShow() {
    if (!currentPlayer) return;
    const playerTips = getPlayerTips(currentPlayer);
    const matches = loadMatches();

    let results = [];
    let totalPoints = 0;

    matches.forEach(m => {
      const tip = playerTips[m.id];
      if (tip && tip.length === 2 && m.result) {
        const pts = getPoints(tip[0], tip[1], m.result[0], m.result[1]);
        totalPoints += pts;
        results.push(`${m.team1} ${tip[0]} - ${tip[1]} ${m.team2} ‚Üí Pont: ${pts}`);
      }
    });

    if (results.length === 0) {
      tipResult.innerHTML = "<p class='italic text-gray-600'>M√©g nem adt√°l meg tippet vagy nincs lez√°rt meccs eredm√©ny.</p>";
    } else {
      tipResult.innerHTML = `
        <h3 class="text-xl font-semibold mb-2">Eredm√©nyeid:</h3>
        <ul class="list-disc pl-5 mb-4">${results.map(r => `<li>${r}</li>`).join("")}</ul>
        <div class="text-lg font-bold">√ñsszpontsz√°m: ${totalPoints} pont</div>
      `;
    }
  }

  // Tipp ment√©se
  submitTipsBtn.addEventListener("click", () => {
    if (!currentPlayer) return;

    const matches = loadMatches();
    const playerTips = getPlayerTips(currentPlayer);

    // Csak az akt√≠v meccsekre tippel√ºnk
    const activeMatches = matches.filter(m => m.status === "active");

    activeMatches.forEach(m => {
      const input1 = tipForm.querySelector(`[name="tip_${m.id}_team1"]`);
      const input2 = tipForm.querySelector(`[name="tip_${m.id}_team2"]`);

      const val1 = input1 ? parseInt(input1.value) : null;
      const val2 = input2 ? parseInt(input2.value) : null;

      if (!isNaN(val1) && !isNaN(val2)) {
        playerTips[m.id] = [val1, val2];
      } else {
        delete playerTips[m.id];
      }
    });

    savePlayerTips(currentPlayer, playerTips);
    loadPlayerTipsAndShow();
    renderLeaderboard();
  });

  // Ranglista megjelen√≠t√©se
  function renderLeaderboard() {
    const tips = loadTips();
    const matches = loadMatches();

    const scores = [];

    for (const player in tips) {
      let totalPoints = 0;
      const playerTips = tips[player];

      matches.forEach(m => {
        const tip = playerTips[m.id];
        if (tip && tip.length === 2 && m.result) {
          totalPoints += getPoints(tip[0], tip[1], m.result[0], m.result[1]);
        }
      });

      scores.push({ player, points: totalPoints });
    }

    scores.sort((a, b) => b.points - a.points);

    leaderboard.innerHTML = "";

    if (scores.length === 0) {
      leaderboard.innerHTML = "<li class='italic'>M√©g nincs tippel≈ë j√°t√©kos.</li>";
      return;
    }

    scores.forEach(s => {
      const li = document.createElement("li");
      li.textContent = `${s.player}: ${s.points} pont`;
      leaderboard.appendChild(li);
    });
  }

  // --- Inicializ√°l√°s ---
  renderMatchesList();
  renderLeaderboard();
  function checkAdminPassword() {
    const input = document.getElementById("adminPassword").value;
    const error = document.getElementById("adminError");
    if (input === "admin123") {
      document.getElementById("adminLogin").classList.add("hidden");
      document.getElementById("adminPanel").classList.remove("hidden");
    } else {
      error.classList.remove("hidden");
    }
  }

</script>
</body>
</html>
